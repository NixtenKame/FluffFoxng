<div id="c-moderator-badges"><div id="a-index">
  <h1>Badge Manager</h1>

  <div class="section">
    <h2>Create Badge</h2>
    <%= render "form", badge: @badge, url: moderator_badges_path, submit_label: "Create Badge" %>
  </div>

  <table class="striped">
    <thead>
      <tr>
        <th>Name</th>
        <th>Status</th>
        <th>Color</th>
        <th>Description</th>
        <th>Assignments</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% @badges.each do |badge| %>
        <tr>
          <td><strong><%= badge.name %></strong></td>
          <td><%= badge.active? ? "Active" : "Hidden" %></td>
          <td><code><%= badge.color %></code></td>
          <td><%= badge.description %></td>
          <td>
            <div>
              <%= form_tag(assign_moderator_badge_path(badge), method: :post) do %>
                <%= text_field_tag :user_name, "", placeholder: "username" %>
                <%= submit_tag "Assign" %>
              <% end %>
            </div>
            <div style="margin-top: 0.5rem;">
              <% badge.user_badges.first(15).each do |user_badge| %>
                <%= form_tag(unassign_moderator_badge_path(badge), method: :post, style: "display:inline-block; margin: 0 0.25rem 0.25rem 0;") do %>
                  <%= hidden_field_tag :user_name, user_badge.user.name %>
                  <%= submit_tag "Remove #{user_badge.user.name}" %>
                <% end %>
              <% end %>
              <% if badge.user_badges.size > 15 %>
                <span>...and <%= badge.user_badges.size - 15 %> more</span>
              <% end %>
            </div>
          </td>
          <td>
            <%= link_to "Edit", edit_moderator_badge_path(badge), class: "button" %>
            <%= link_to "Delete", moderator_badge_path(badge), method: :delete, data: { confirm: "Delete this badge and all assignments?" }, class: "button" %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div></div>

<% content_for(:page_title) do %>
  Badge Manager
<% end %>
